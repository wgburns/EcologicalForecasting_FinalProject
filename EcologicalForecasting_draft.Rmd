---
title: "Ecological Forecasting Final Project Draft"
author: "WB"
date: "12/2/2019"
output: 
  pdf_document:
    citation_package: natbib
bibliography: EcologicalForecastingRefs.bib
csl: limnology-and-oceanography.csl
---

## 1. Introduction 

GENERAL NOTES:  

* why important to study? 
* cite a few other studies doing similar work 
* end intro with "in this study" paragraph to set up reader to how we plan to attack the problem 
* hypotheses? 
* Figs for this section: 
  + map of study area 
  + bar graph of cyanobacteria bloom timing being different every year (long-term monitoring)
  
Anthropogenic eutrophication, meaning increases in nutrients entering aquatic systems due to human activity, of natural water bodies is a global phenomenon that often leads to decreased utility of affected ecosystems (eg. Reynolds 1987; Paerl 1988; Paerl et al. 2011). One problem associated with eutrophication is that harmful cyanobacteria blooms are becoming more prevalent in coastal oceans and thousands of inland lakes and ponds (Paerl et al. 2001, 2011; Paerl and Huisman 2008). Phytoplankton play an integral role as the base of aquatic food webs in both freshwater and marine systems, however, when cyanobacteria growth is unchecked, blooms can be detrimental to organisms living in and around freshwater ecosystems and often cause problems that propogate up the food web (add REFS). The climate is changing, and environmental conditions are becoming more favorable for bloom-forming harmful cyanobacteria (Jöhnk et al. 2006; Paerl and Huisman 2008; Jeppesen et al. 2011; Huisman et al. 2018). Therefore, it is becoming increasingly important to understand cyanobacteria bloom onset and senescence. Understanding why and when severe cyanobacteria blooms occur will help inform mitigation efforts. 

### 1.1 Factors that drive cyanobacteria blooms 

**Goal with this section: Develop what is known from what is not known or what has conflicting attributions (and why), and how this leads you to your research question. This driver – that is, different watersheds and connectivity – needs to be developed in the Intro to show the reader this is a valid research question/hypothesis to pursue.**

- Eutrophication (can mention watershed bay interactions in this section)
- Warm temperatures
- Water column stratification (leads to internal loading of nutrients)
- Increased CO2 in the atmosphere (some types of cyanobacteria more efficiently produce organic matter 
- Rain and wind events (mix up water column prohibiting internal loading of nutrients and also giving advantage to larger phytoplankton, like diatoms, that need turbulence to get mixed up into the photic zone)
- Cyanobacteria are physiologically diverse and have developed multiple strategies to outcompete other types of phytoplankton: N-fixation, CO2 concentrating mechanisms, buoyancy regulation, toxin production, predator avoidance 
- Top-down grazing by zooplankton – however, many studies have shown that cyanobacteria often avoid grazing by forming dense colonies and toxin production (DeMott 1986; Lemaire et al. 2012)
- Viral lysis or fungal infection – often don’t result in long-lasting effects on cyanobacteria populations (Yoshida et al. 2008; Van Wichelen et al. 2016)
- Filter feeders like mussels - effect they have on cyanobacteria blooms is lake-specific (Reeders et al. 1989; Vanderploeg et al. 2001)
- Competition from other, non-harmful, phytoplankton 

How does lake size (area/depth) affect which drivers may be relatively important (shallow vs deep)? Lake trophic status? 






## 2. Methods 

* study sites 
* data used and how prepped 
  + buoy sensor data (MC)
  + meteorological station data (WB): air temp, solar radiation, wind speed, wind direction
  + discharge data (WB)
* data analysis - feature important (HC)

### 2.2.1 Preparing the high frequency buoy data (MC)

In order to run a forcasting model or look at feature importance with time lags, we first needed to collapse our hourly data into daily data, so that daily cycles would not confound predictions or time lags. At this point, we explored whether to use daily averages or daily maximums. R was used to calculate daily averages and maximums for each buoy variable. It was also used to create timeplots of the daily and hourly data. After inspecting the timeplots, we decided to use daily averages rather than daily maximums, as the later were unduly influenced by sudden peaks and fluctuations in the hourly data. 

Since the buoys have sensors at multiple depths, we also considered whether to focus on surface-level measurements or to aggregate data from whatever depth had the highest concentration of PC at a given time.

## 3. Results  

* fig of time series of the parameters to set the scene? 
* which set of feature importance do we want to use? 

Next steps for today 12/2/19: 
- figure out way to make figure that is easy to digest --> take out Chl, pH, and ODO and then have a stacked bar graph with y axis of feature importance (all add up to 1) and x axis being days in future (0 - 6)
- need to sep feature importance by bay and year AND figure out how to make a table with the results so i can make the stacked bar graph 

#### Brief typed out results for easier interpretation 

1) St AB both years 

- 0 day lag: pH, spCond, temp, discharge, deltaTemp
- 1 day lag: pH, spCond, discharge, temp 
- 2 day lag: pH, spCond, discharge, ODO
- 3 day lag: pH, spCond, discharge, deltaTemp
- 4 day lag: pH, spCond, deltaTemp, ws
- 5 day lag: pH, spCond, deltaTemp, wd, ODO 
- 6 day lag: pH, spCond, ODO, ws, discharge


2) MB both years 

- 0 day lag: pH, ODO, discharge, wd (deltaTEmp last)
- 1 day lag: pH, dishcarge, ODO, spCond, wd (deltaTemp moves up)
- 2 day lag: pH, ODO, wd, solar, spCond, 
- 3 day lag: pH, spCond, temp, wd, deltaTemp
- 4 day lag: spCond, pH, temp, ODO, ws, deltaTemp
- 5 day lag: spCond, temp, pH, ODO, deltaTemp, wd
- 6 day lag: spCond, temp, pH, ODO, wd, discharge, deltaTemp


3) 2017 both bays 

- 0 day lag: dishcarge, spCond, pH, ODO 
- 1 day lag: spCond, ODO, discharge, pH, solar 
- 2 day lag: pH, spCond, discharge, ws, ODO
- 3 day lag: spCond, ODO, discharge, solar
- 4 day lag: spCond, ODO, solar, wd, temp 
- 5 day lag: spCond, deltaTemp, solar, wd, temp 
- 6 day lag: deltaTemp, spCond, ODO, wd, discharge

4) 2018 both bays 

- 0 day lag: pH, spCond, ODO, discharge 
- 1 day lag: pH, spCond, discharge, ODO 
- 2 day lag: pH, discharge, temp, spCond
- 3 day lag: pH, ODO, discharge, spCond, temp 
- 4 day lag: pH, spCond, discharge, temp, deltaTemp 
- 5 day lag: pH, spCond, temp, discharge, ODO
- 6 day lag: pH, spCond, temp, solar, ODO 

5) both bays both years 

- 0 day lag: pH, spCond, year, discharge, solar
- 1 day lag: pH, spCond, year, discharge, temp
- 2 day lag: pH, spCond, discharge, year, deltaTemp
- 3 day lag: pH, spCond, discharge, year, ODO 
- 4 day lag: pH, spCond, year, discharge, ODO 
- 5 day lag: pH, spCond, temp, ODO, year, discharge 
- 6 day lag: pH, spCond, temp, year, deltaTemp, ODO 



LOOK INTO 
- is spCond just super highly correlated with PC? Why is it such an important feature? What is it highly correlated with? are the units different between the bays? 
- wd (not speed) is important for mb! let's look at correlations 
- should we run without pH? 
- what's the significance in the difference in the cluster numbers?? 

## Discussion 

- what we know right now is that 6 days out, pH is IMPORTANT for PC but the next step is figuring out if it's PREDICTIVE of a bloom --> need to build model 
- We got kinda hung up on the fact that there were parameters in the feature analysis results that were highly correlated with PC (response variable) but Easton reminded us that if our main goal is to predict a bloom, Chl or PC levels 6 days before is important to include if we are building a predictive model because that's still useful info ! Like it'd be great if we could predict if a bloom would start in 6 days just by knowing PC or Chl levels. 
- IMPORTANT POINT: there is a difference between mechanistic models and predictive models. Depending on how we decide to move forward (ie. which model we choose) we might not really need to understand the mechanisms driving the blooms because we might just try throwing all the data into a machine learning algorithm that tells us the relative predictive power of each of the parameters (I think...). 

## Future work 



## References 

INFO ON HOW TO CITE in .Rmd from https://rmarkdown.rstudio.com/authoring_bibliographies_and_citations.html : 

* Citations go inside square brackets and are separated by semicolons. Each citation must have a key, composed of ‘@’ + the citation identifier from the database, and may optionally have a prefix, a locator, and a suffix. Here are some examples:
  + Blah blah [@isles_modeling_2017].
* Then in Zotero create a `.BibTex` file by going to File --> Export Library --> change to BibTex




